[{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\(announcements)\\announcements.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\(announcements)\\crud.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\(announcements)\\resend.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'valid' is assigned a value but never used.","line":54,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'batchId' is defined but never used.","line":109,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":109,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { resend } from \"@/lib/resend\";\r\nimport { render } from \"@react-email/render\";\r\nimport { AnnouncementEmail } from \"@/components/email/announcement\";\r\nimport React from \"react\";\r\n\r\ninterface SendEmailParams {\r\n  recipients: Array<{ email: string; name?: string }>;\r\n  title: string;\r\n  content: string;\r\n  teamName: string;\r\n}\r\n\r\ninterface BatchSendResult {\r\n  batchIds: string[];\r\n  totalRecipients: number;\r\n}\r\n\r\nconst BATCH_LIMIT = 100;\r\n\r\n/**\r\n * Validates email addresses\r\n */\r\nexport function validateEmails(emails: string[]): {\r\n  valid: string[];\r\n  invalid: string[];\r\n} {\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n  const valid: string[] = [];\r\n  const invalid: string[] = [];\r\n\r\n  for (const email of emails) {\r\n    if (emailRegex.test(email)) {\r\n      valid.push(email);\r\n    } else {\r\n      invalid.push(email);\r\n    }\r\n  }\r\n\r\n  return { valid, invalid };\r\n}\r\n\r\n/**\r\n * Sends announcement email to multiple recipients using Resend batch API\r\n * Handles batch splitting for >100 recipients\r\n */\r\nexport async function sendAnnouncementEmail({\r\n  recipients,\r\n  title,\r\n  content,\r\n  teamName,\r\n}: SendEmailParams): Promise<BatchSendResult> {\r\n  // Validate all emails first\r\n  const emails = recipients.map((r) => r.email);\r\n  const { valid, invalid } = validateEmails(emails);\r\n\r\n  if (invalid.length > 0) {\r\n    throw new Error(`Invalid email addresses: ${invalid.join(\", \")}`);\r\n  }\r\n\r\n  const batchIds: string[] = [];\r\n\r\n  // Split into batches if needed\r\n  for (let i = 0; i < recipients.length; i += BATCH_LIMIT) {\r\n    const batch = recipients.slice(i, i + BATCH_LIMIT);\r\n\r\n    // Render all emails in the batch (render is async in v2.x)\r\n    const renderedHtmls = await Promise.all(\r\n      batch.map((recipient) =>\r\n        render(\r\n          React.createElement(AnnouncementEmail, {\r\n            title,\r\n            content,\r\n            teamName,\r\n            memberName: recipient.name,\r\n          }),\r\n        ),\r\n      ),\r\n    );\r\n\r\n    // Create email objects with rendered HTML\r\n    const emails = batch.map((recipient, index) => ({\r\n      from: \"Taskboard <onboarding@resend.dev>\", // TODO: Replace with your verified domain\r\n      to: recipient.email,\r\n      subject: `${teamName}: ${title}`,\r\n      html: renderedHtmls[index],\r\n    }));\r\n\r\n    // Send batch\r\n    const { data, error } = await resend.batch.send(emails);\r\n\r\n    if (error) {\r\n      throw new Error(`Resend API error: ${error.message}`);\r\n    }\r\n\r\n    if (data?.id) {\r\n      batchIds.push(data.id);\r\n    }\r\n  }\r\n\r\n  return {\r\n    batchIds,\r\n    totalRecipients: recipients.length,\r\n  };\r\n}\r\n\r\n/**\r\n * Query Resend API for batch status (for reconciliation)\r\n */\r\nexport async function getBatchStatus(batchId: string) {\r\n  try {\r\n    // Note: Resend doesn't have a direct batch status endpoint yet\r\n    // This is a placeholder for future implementation\r\n    // For now, rely on webhooks for status updates\r\n    return { status: \"unknown\" };\r\n  } catch (error) {\r\n    console.error(\"Error fetching batch status:\", error);\r\n    return { status: \"error\" };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\(calendar)\\calendar.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\(calendar)\\calendar_db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\(events)\\event.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CalendarEventSchema' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[984,987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[984,987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2794,2797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2794,2797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":126,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3561,3564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3561,3564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4076,4079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4076,4079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4733,4736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4733,4736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5980,5983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5980,5983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":283,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7804,7807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7804,7807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":300,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8328,8331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8328,8331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8837,8840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8837,8840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":342,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9475,9478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9475,9478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":368,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10108,10111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10108,10111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":383,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10578,10581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10578,10581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\";\r\nimport { getCalendarClient } from \"./google\";\r\nimport { CalendarEventSchema } from \"@/lib/validations\";\r\nimport {\r\n  createCalendarEvent_DB,\r\n  updateCalendarEvent_DB,\r\n  deleteCalendarEvent_DB,\r\n} from \"./event_db\";\r\nimport { getTeamCalendarId } from \"../(calendar)/calendar\";\r\nimport { getUser } from \"../auth\";\r\nimport prisma from \"@/utils/prisma/prisma\";\r\nimport { getMembersForTeam } from \"../members\";\r\n\r\n// TODO: Can be set by user\r\nconst DEFAULT_TIMEZONE = \"Asia/Manila\";\r\n\r\n// Creates an event in a team's calendar.\r\nexport async function createCalendarEvent(\r\n  teamId: string,\r\n  eventDetails: {\r\n    title: string;\r\n    start: Date;\r\n    end: Date;\r\n    description?: string;\r\n  },\r\n) {\r\n  let leader_id: string;\r\n\r\n  // validate and get user id\r\n  try {\r\n    const user = await getUser();\r\n    const idHelper = user.data.user?.id;\r\n    if (!idHelper) {\r\n      throw new Error(\"User not authenticated\");\r\n    }\r\n    leader_id = idHelper;\r\n  } catch (error: any) {\r\n    console.error(`Error creating calendar: ${teamId}`, error?.message);\r\n    return {\r\n      success: false,\r\n      error: error?.message || `Failed to create calendar: ${teamId}`,\r\n    };\r\n  }\r\n\r\n  // get calendar id\r\n  const calendarId = await getTeamCalendarId(teamId, leader_id);\r\n  if (!calendarId) {\r\n    return {\r\n      success: false,\r\n      error: \"Failed to get calendar id\",\r\n    };\r\n  }\r\n  try {\r\n    const { client } = await getCalendarClient();\r\n\r\n    // Note: Validation is handled by the caller (Zod schema at form level)\r\n\r\n    // Fetch team members to add as attendees\r\n    const membersResult = await getMembersForTeam(teamId);\r\n    const attendees =\r\n      membersResult.success && membersResult.members\r\n        ? membersResult.members.map((m) => ({ email: m.email }))\r\n        : [];\r\n\r\n    // Create Event\r\n    const response = await client.events.insert({\r\n      calendarId: calendarId,\r\n      sendUpdates: \"none\", // Don't send email notifications\r\n      requestBody: {\r\n        summary: eventDetails.title,\r\n        description: eventDetails.description,\r\n        start: {\r\n          dateTime: eventDetails.start.toISOString(),\r\n          timeZone: DEFAULT_TIMEZONE,\r\n        },\r\n        end: {\r\n          dateTime: eventDetails.end.toISOString(),\r\n          timeZone: DEFAULT_TIMEZONE,\r\n        },\r\n        attendees: attendees,\r\n      },\r\n    });\r\n\r\n    const calendarEventId = response.data.id;\r\n\r\n    // Check if event was created before db update\r\n    if (!calendarEventId) {\r\n      return {\r\n        success: false,\r\n        error: \"Failed to create event\",\r\n      };\r\n    }\r\n\r\n    // save to database\r\n    try {\r\n      await createCalendarEvent_DB(\r\n        calendarId,\r\n        teamId,\r\n        eventDetails,\r\n        calendarEventId,\r\n      );\r\n    } catch (dbError: any) {\r\n      console.error(\"DB Error. Rolling back Google Event...\", dbError.message);\r\n\r\n      // Delete event from google calendar\r\n      try {\r\n        await client.events.delete({\r\n          calendarId: calendarId,\r\n          eventId: calendarEventId,\r\n        });\r\n        console.log(\"✅ Rollback successful: Google Event deleted.\");\r\n      } catch (rollbackError) {\r\n        // Rollback error\r\n        console.error(\"System data is inconsistent.\", rollbackError);\r\n        // TODO: Send alert to admin / deadlock queue\r\n      }\r\n\r\n      throw new Error(`System Error: Failed to save event. ${dbError.message}`);\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      eventId: response.data.id,\r\n      eventLink: response.data.htmlLink,\r\n    };\r\n  } catch (error: any) {\r\n    console.error(\"Error creating event:\", error?.message);\r\n    return {\r\n      success: false,\r\n      error: error?.message || \"Failed to create event\",\r\n    };\r\n  }\r\n}\r\n// Get team events (google)\r\nexport async function getTeamEvents(teamId: string) {\r\n  // Get user\r\n  let leader_id: string;\r\n  try {\r\n    const user = await getUser();\r\n    const idHelper = user.data.user?.id;\r\n    if (!idHelper) {\r\n      throw new Error(\"User not authenticated\");\r\n    }\r\n    leader_id = idHelper;\r\n  } catch (error: any) {\r\n    console.error(`Error in getTeamEvents: ${teamId}`, error?.message);\r\n    return {\r\n      success: false,\r\n      error: error?.message || \"Authentication failed\",\r\n    };\r\n  }\r\n\r\n  // Resolve calendarId from teamId\r\n  const calendarId = await getTeamCalendarId(teamId, leader_id);\r\n  if (!calendarId) {\r\n    return {\r\n      success: false,\r\n      error: \"Failed to get calendar id\",\r\n    };\r\n  }\r\n\r\n  try {\r\n    const { client } = await getCalendarClient();\r\n    const response = await client.events.list({\r\n      calendarId: calendarId,\r\n    });\r\n    return {\r\n      success: true,\r\n      events: response.data.items,\r\n    };\r\n  } catch (error: any) {\r\n    console.error(\"Error getting events:\", error?.message);\r\n    return {\r\n      success: false,\r\n      error: error?.message || \"Failed to get events\",\r\n    };\r\n  }\r\n}\r\nexport async function updateCalendarEvent(\r\n  teamId: string,\r\n  eventData: {\r\n    id: string;\r\n    title?: string;\r\n    start?: Date;\r\n    end?: Date;\r\n    googleEventId?: string | null;\r\n    desc?: string;\r\n  },\r\n) {\r\n  // Extract and validate required fields\r\n  const { id: eventId, title, start, end, googleEventId, desc } = eventData;\r\n\r\n  // Map desc to description for DB layer\r\n  const description = desc;\r\n\r\n  if (!eventId) {\r\n    return {\r\n      success: false,\r\n      error: \"Missing required field: eventId is required for update\",\r\n    };\r\n  }\r\n  if (!title || !start || !end) {\r\n    return {\r\n      success: false,\r\n      error:\r\n        \"Missing required fields: title, start, and end are required for update\",\r\n    };\r\n  }\r\n\r\n  const eventDetails = { title, start, end, description };\r\n  let leader_id: string;\r\n  // validate and get user id\r\n  try {\r\n    const user = await getUser();\r\n    const idHelper = user.data.user?.id;\r\n    if (!idHelper) {\r\n      throw new Error(\"User not authenticated\");\r\n    }\r\n    leader_id = idHelper;\r\n  } catch (error: any) {\r\n    console.error(`Error creating calendar: ${teamId}`, error?.message);\r\n    return {\r\n      success: false,\r\n      error: error?.message || `Failed to create calendar: ${teamId}`,\r\n    };\r\n  }\r\n\r\n  // get calendar id\r\n  const calendarId = await getTeamCalendarId(teamId, leader_id);\r\n  if (!calendarId) {\r\n    return {\r\n      success: false,\r\n      error: \"Failed to get calendar id\",\r\n    };\r\n  }\r\n\r\n  // Validate googleEventId for Google API call\r\n  if (!googleEventId) {\r\n    return {\r\n      success: false,\r\n      error: \"Missing googleEventId: cannot update event in Google Calendar\",\r\n    };\r\n  }\r\n\r\n  try {\r\n    const { client } = await getCalendarClient();\r\n\r\n    // Fetch team members to add as attendees\r\n    const membersResult = await getMembersForTeam(teamId);\r\n    const attendees =\r\n      membersResult.success && membersResult.members\r\n        ? membersResult.members.map((m) => ({ email: m.email }))\r\n        : [];\r\n\r\n    const response = await client.events.update({\r\n      calendarId: calendarId,\r\n      eventId: googleEventId,\r\n      sendUpdates: \"none\", // Don't send email notifications\r\n      requestBody: {\r\n        summary: eventDetails.title,\r\n        description: eventDetails.description,\r\n        start: {\r\n          dateTime: eventDetails.start.toISOString(),\r\n          timeZone: DEFAULT_TIMEZONE,\r\n        },\r\n        end: {\r\n          dateTime: eventDetails.end.toISOString(),\r\n          timeZone: DEFAULT_TIMEZONE,\r\n        },\r\n        attendees: attendees,\r\n      },\r\n    });\r\n    // Check if event was updated before db update\r\n    if (!response.data.id) {\r\n      return {\r\n        success: false,\r\n        error: \"Failed to update event\",\r\n      };\r\n    }\r\n    // Save changes to DB\r\n    try {\r\n      await updateCalendarEvent_DB(eventId, eventDetails);\r\n    } catch (dbError: any) {\r\n      console.error(\r\n        \"❌ DB Consistency Failure during Update. Google Event updated, but DB failed.\",\r\n        dbError.message,\r\n      );\r\n      // NOTE: Rolling back an update is complex (needs old data).\r\n      // For now, we log the inconsistency.\r\n      throw new Error(\r\n        `System Error: Failed to update event in DB. ${dbError.message}`,\r\n      );\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      eventId: response.data.id,\r\n      eventLink: response.data.htmlLink,\r\n    };\r\n  } catch (error: any) {\r\n    console.error(\"Error updating event:\", error?.message);\r\n    return {\r\n      success: false,\r\n      error: error?.message || \"Failed to update event\",\r\n    };\r\n  }\r\n}\r\nexport async function deleteCalendarEvent(teamId: string, eventId: string) {\r\n  // Get user\r\n  let leader_id: string;\r\n  try {\r\n    const user = await getUser();\r\n    const idHelper = user.data.user?.id;\r\n    if (!idHelper) {\r\n      throw new Error(\"User not authenticated\");\r\n    }\r\n    leader_id = idHelper;\r\n  } catch (error: any) {\r\n    console.error(`Error in deleteCalendarEvent: ${teamId}`, error?.message);\r\n    return {\r\n      success: false,\r\n      error: error?.message || \"Authentication failed\",\r\n    };\r\n  }\r\n\r\n  // Resolve calendarId from teamId\r\n  const calendarId = await getTeamCalendarId(teamId, leader_id);\r\n  if (!calendarId) {\r\n    return {\r\n      success: false,\r\n      error: \"Failed to get calendar id\",\r\n    };\r\n  }\r\n\r\n  // Fetch event from DB to get googleEventId\r\n  let dbEvent;\r\n  try {\r\n    dbEvent = await prisma.events.findUnique({\r\n      where: { id: eventId },\r\n      select: { google_event_id: true },\r\n    });\r\n  } catch (dbError: any) {\r\n    console.error(\r\n      \"Database query failed in deleteCalendarEvent:\",\r\n      dbError.message,\r\n    );\r\n    return {\r\n      success: false,\r\n      error: `Database error: ${dbError.message}`,\r\n    };\r\n  }\r\n\r\n  if (!dbEvent || !dbEvent.google_event_id) {\r\n    return {\r\n      success: false,\r\n      error: \"Event not found or missing Google Event ID\",\r\n    };\r\n  }\r\n\r\n  try {\r\n    const { client } = await getCalendarClient();\r\n    await client.events.delete({\r\n      calendarId: calendarId,\r\n      eventId: dbEvent.google_event_id,\r\n    });\r\n    try {\r\n      await deleteCalendarEvent_DB(eventId);\r\n    } catch (dbError: any) {\r\n      console.error(\r\n        \"❌ DB Consistency Failure during Delete. Google Event deleted, but DB failed (Zombie Data).\",\r\n        dbError.message,\r\n      );\r\n      // NOTE: Rolling back a delete means RE-CREATING the event (new ID).\r\n      // For now, we log the inconsistency.\r\n      throw new Error(\r\n        `System Error: Failed to delete event in DB. ${dbError.message}`,\r\n      );\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n    };\r\n  } catch (error: any) {\r\n    console.error(\"Error deleting event:\", error?.message);\r\n    return {\r\n      success: false,\r\n      error: error?.message || \"Failed to delete event\",\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\(events)\\event_db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\(events)\\google.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1487,1490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1487,1490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\";\r\nimport { google } from \"googleapis\";\r\nimport { getUser } from \"../auth\";\r\nimport prisma from \"@/utils/prisma/prisma\";\r\nimport { getOAuth2Client } from \"@/lib/google-calendar\";\r\n\r\n// Nullify to break auth loops\r\nasync function nullifyToken(userId: string) {\r\n  console.warn(`Nullifying invalid token for user ${userId}`);\r\n  await prisma.profiles.update({\r\n    where: { id: userId },\r\n    data: { google_refresh_token: null },\r\n  });\r\n}\r\n\r\n// Gets calendar client, if invalid token (400) nullify and re-auth\r\nexport async function getCalendarClient() {\r\n  const user = await getUser();\r\n  const userId = user.data.user?.id;\r\n\r\n  if (!userId) throw new Error(\"User not authenticated\");\r\n\r\n  const profile = await prisma.profiles.findUnique({\r\n    where: { id: userId },\r\n    select: { google_refresh_token: true },\r\n  });\r\n\r\n  if (!profile?.google_refresh_token) {\r\n    throw new Error(\"No Google refresh token found. Please reconnect.\");\r\n  }\r\n\r\n  const oauth2Client = getOAuth2Client();\r\n  oauth2Client.setCredentials({ refresh_token: profile.google_refresh_token });\r\n\r\n  return {\r\n    client: google.calendar({ version: \"v3\", auth: oauth2Client }),\r\n    userId,\r\n  };\r\n}\r\n\r\n// Checks permission, if error, nullify and re-auth\r\nexport async function checkCalendarPermissions() {\r\n  try {\r\n    const { client } = await getCalendarClient();\r\n    await client.calendarList.list({ maxResults: 1 });\r\n    return { hasValidToken: true, needsReauth: false };\r\n  } catch (error: any) {\r\n    console.error(\"Permission check failed:\", error?.message);\r\n\r\n    // If any auth error, we need re-auth\r\n    const isAuthError =\r\n      [400, 401, 403].includes(error?.code) ||\r\n      error?.response?.data?.error === \"invalid_request\";\r\n\r\n    if (isAuthError) {\r\n      const user = await getUser();\r\n      const userId = user.data.user?.id;\r\n      if (userId) await nullifyToken(userId);\r\n      return { hasValidToken: false, needsReauth: true };\r\n    }\r\n\r\n    return { hasValidToken: false, needsReauth: true };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\members.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\actions\\teams.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\(auth)\\login\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\(auth)\\login\\components\\AboutBtn.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\(auth)\\login\\components\\ErrorMsg.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\(auth)\\login\\components\\SignInButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\(auth)\\login\\components\\Star.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\(auth)\\login\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\(auth)\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\404\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\about\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\api\\webhooks\\resend\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1337,1340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1337,1340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3275,3278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3275,3278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport prisma from \"@/utils/prisma/prisma\";\r\nimport { EmailStatus } from \"@prisma/client\";\r\nimport { Webhook } from \"svix\";\r\n\r\n/**\r\n * Resend webhook handler\r\n * Receives delivery status updates from Resend\r\n *\r\n * Events: email.sent, email.delivered, email.bounced, email.complained\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const webhookSecret = process.env.RESEND_WEBHOOK_SECRET;\r\n\r\n    if (!webhookSecret) {\r\n      console.error(\"RESEND_WEBHOOK_SECRET not configured\");\r\n      return NextResponse.json(\r\n        { error: \"Webhook not configured\" },\r\n        { status: 500 },\r\n      );\r\n    }\r\n\r\n    // Get webhook headers for signature verification\r\n    const svixId = request.headers.get(\"svix-id\");\r\n    const svixTimestamp = request.headers.get(\"svix-timestamp\");\r\n    const svixSignature = request.headers.get(\"svix-signature\");\r\n\r\n    if (!svixId || !svixTimestamp || !svixSignature) {\r\n      console.warn(\"Missing svix headers\");\r\n      return NextResponse.json(\r\n        { error: \"Missing webhook headers\" },\r\n        { status: 401 },\r\n      );\r\n    }\r\n\r\n    // Get raw body for signature verification\r\n    const body = await request.text();\r\n\r\n    // Verify webhook signature\r\n    const wh = new Webhook(webhookSecret);\r\n    let payload: any;\r\n\r\n    try {\r\n      payload = wh.verify(body, {\r\n        \"svix-id\": svixId,\r\n        \"svix-timestamp\": svixTimestamp,\r\n        \"svix-signature\": svixSignature,\r\n      });\r\n    } catch (err) {\r\n      console.error(\"Webhook signature verification failed:\", err);\r\n      return NextResponse.json({ error: \"Invalid signature\" }, { status: 401 });\r\n    }\r\n\r\n    // Parse verified payload\r\n    const { type, data } = payload;\r\n\r\n    console.log(\"Received webhook:\", type, data);\r\n\r\n    // Extract batch ID from the event\r\n    // Note: Resend's webhook structure may vary, adjust as needed\r\n    const batchId = data?.batch_id || data?.id;\r\n\r\n    if (!batchId) {\r\n      console.warn(\"No batch ID in webhook payload\");\r\n      return NextResponse.json({ received: true }, { status: 200 });\r\n    }\r\n\r\n    // Find announcement by batch ID\r\n    // Handle both single ID and JSON array of IDs\r\n    const announcements = await prisma.announcements.findMany({\r\n      where: {\r\n        OR: [\r\n          { resend_batch_id: batchId },\r\n          { resend_batch_id: { contains: batchId } },\r\n        ],\r\n      },\r\n    });\r\n\r\n    if (announcements.length === 0) {\r\n      console.warn(`No announcement found for batch ID: ${batchId}`);\r\n      // Return 200 to acknowledge webhook (idempotent)\r\n      return NextResponse.json({ received: true }, { status: 200 });\r\n    }\r\n\r\n    // Process each announcement\r\n    for (const announcement of announcements) {\r\n      await processWebhookEvent(announcement.id, type, data);\r\n    }\r\n\r\n    return NextResponse.json({ received: true }, { status: 200 });\r\n  } catch (error) {\r\n    console.error(\"Error processing webhook:\", error);\r\n    // Always return 200 to prevent Resend from retrying\r\n    return NextResponse.json({ received: true }, { status: 200 });\r\n  }\r\n}\r\n\r\n/**\r\n * Process individual webhook event\r\n */\r\nasync function processWebhookEvent(\r\n  announcementId: bigint,\r\n  eventType: string,\r\n  eventData: any,\r\n) {\r\n  try {\r\n    const announcement = await prisma.announcements.findUnique({\r\n      where: { id: announcementId },\r\n    });\r\n\r\n    if (!announcement) return;\r\n\r\n    switch (eventType) {\r\n      case \"email.sent\":\r\n        // Email accepted by Resend, no action needed\r\n        break;\r\n\r\n      case \"email.delivered\":\r\n        // Increment delivered count\r\n        await prisma.announcements.update({\r\n          where: { id: announcementId },\r\n          data: {\r\n            delivered_count: {\r\n              increment: 1,\r\n            },\r\n          },\r\n        });\r\n\r\n        // Check if all emails delivered\r\n        const updated = await prisma.announcements.findUnique({\r\n          where: { id: announcementId },\r\n        });\r\n\r\n        if (\r\n          updated &&\r\n          updated.delivered_count >= updated.recipient_count &&\r\n          updated.email_status === EmailStatus.SENDING\r\n        ) {\r\n          await prisma.announcements.update({\r\n            where: { id: announcementId },\r\n            data: {\r\n              email_status: EmailStatus.SENT,\r\n            },\r\n          });\r\n        }\r\n        break;\r\n\r\n      case \"email.bounced\":\r\n      case \"email.complained\":\r\n        // Handle failures\r\n        const failedEmail = eventData?.email || \"unknown\";\r\n        const currentErrors = announcement.error_message || \"\";\r\n        const failedEmails = currentErrors ? JSON.parse(currentErrors) : [];\r\n\r\n        if (!failedEmails.includes(failedEmail)) {\r\n          failedEmails.push(failedEmail);\r\n        }\r\n\r\n        await prisma.announcements.update({\r\n          where: { id: announcementId },\r\n          data: {\r\n            error_message: JSON.stringify(failedEmails),\r\n            email_status:\r\n              failedEmails.length > 0\r\n                ? EmailStatus.PARTIALLY_FAILED\r\n                : announcement.email_status,\r\n          },\r\n        });\r\n        break;\r\n\r\n      default:\r\n        console.log(`Unhandled event type: ${eventType}`);\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error processing webhook event:\", error);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\auth\\auth-code-error\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\auth\\callback\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\CalendarPermissionsBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\NewTeamBtn.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\SignOutBtn.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\WelcomeMsg.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\team-table\\ActionsMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\team-table\\ConfirmationModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\team-table\\EditTeamModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\team-table\\Pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\team-table\\SearchInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\team-table\\TeamTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\team-table\\data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\team-table\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\components\\team-table\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(announcements)\\components\\AnnouncementCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(announcements)\\components\\AnnouncementsClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":49,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAnnouncements'. Either include it or remove the dependency array.","line":58,"column":6,"nodeType":"ArrayExpression","endLine":58,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadAnnouncements, teamId]","fix":{"range":[1678,1686],"text":"[loadAnnouncements, teamId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useMemo } from \"react\";\r\nimport { getAnnouncementsForTeam } from \"@/actions/(announcements)/crud\";\r\nimport CreateAnnouncementDialog from \"./CreateAnnouncementDialog\";\r\nimport AnnouncementCard from \"./AnnouncementCard\";\r\nimport { EmailStatus } from \"@prisma/client\";\r\nimport { Button } from \"@/components/ui/Button\";\r\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\r\n\r\ninterface AnnouncementsClientProps {\r\n  teamId: string;\r\n}\r\n\r\ninterface Announcement {\r\n  id: bigint;\r\n  title: string;\r\n  content: string;\r\n  created_at: Date;\r\n  email_status: EmailStatus | null;\r\n  sent_at: Date | null;\r\n  recipient_count: number;\r\n  delivered_count: number;\r\n  error_message: string | null;\r\n}\r\n\r\nconst ITEMS_PER_PAGE = 5;\r\n\r\nexport default function AnnouncementsClient({\r\n  teamId,\r\n}: AnnouncementsClientProps) {\r\n  const [announcements, setAnnouncements] = useState<Announcement[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n\r\n  async function loadAnnouncements() {\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const result = await getAnnouncementsForTeam(teamId);\r\n\r\n      if (result.success && result.announcements) {\r\n        setAnnouncements(result.announcements as Announcement[]);\r\n      } else {\r\n        setError(result.error || \"Failed to load announcements\");\r\n      }\r\n    } catch (err) {\r\n      setError(\"An error occurred while loading announcements\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadAnnouncements();\r\n  }, [teamId]);\r\n\r\n  // Calculate pagination\r\n  const totalPages = Math.ceil(announcements.length / ITEMS_PER_PAGE);\r\n  const paginatedAnnouncements = useMemo(() => {\r\n    const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;\r\n    return announcements.slice(startIndex, startIndex + ITEMS_PER_PAGE);\r\n  }, [announcements, currentPage]);\r\n\r\n  // Reset to page 1 when announcements change\r\n  useEffect(() => {\r\n    setCurrentPage(1);\r\n  }, [announcements.length]);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        {/* Skeleton cards */}\r\n        {[1, 2].map((i) => (\r\n          <div\r\n            key={i}\r\n            className=\"bg-white border-2 border-gray-200 rounded-lg p-4 animate-pulse\"\r\n          >\r\n            <div className=\"h-6 bg-gray-200 rounded w-2/3 mb-3\" />\r\n            <div className=\"h-4 bg-gray-200 rounded w-full mb-2\" />\r\n            <div className=\"h-4 bg-gray-200 rounded w-5/6 mb-4\" />\r\n            <div className=\"h-8 bg-gray-200 rounded w-24\" />\r\n          </div>\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"bg-red-50 border-2 border-red-200 rounded-lg p-4\">\r\n        <p className=\"text-red-700\">{error}</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center gap-4\">\r\n        <div className=\"min-w-0\">\r\n          <h2 className=\"text-xl sm:text-2xl font-bold text-gray-900\">\r\n            Announcements\r\n          </h2>\r\n          <p className=\"text-sm text-gray-600 truncate hidden sm:block\">\r\n            Create and send email announcements to your team members\r\n          </p>\r\n        </div>\r\n        <CreateAnnouncementDialog\r\n          teamId={teamId}\r\n          onSuccess={loadAnnouncements}\r\n        />\r\n      </div>\r\n\r\n      {/* Announcements List */}\r\n      {announcements.length === 0 ? (\r\n        <div className=\"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center\">\r\n          <p className=\"text-gray-600 mb-4\">No announcements yet</p>\r\n          <p className=\"text-sm text-gray-500\">\r\n            Create your first announcement to get started\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <>\r\n          <div className=\"bg-white border border-gray-200 rounded-lg divide-y divide-gray-200\">\r\n            {paginatedAnnouncements.map((announcement) => (\r\n              <AnnouncementCard\r\n                key={announcement.id.toString()}\r\n                announcement={announcement}\r\n                onUpdate={loadAnnouncements}\r\n              />\r\n            ))}\r\n          </div>\r\n\r\n          {/* Pagination */}\r\n          {totalPages > 1 && (\r\n            <div className=\"flex items-center justify-between pt-4 border-t border-gray-200\">\r\n              <p className=\"text-sm text-gray-600\">\r\n                Page {currentPage} of {totalPages} ({announcements.length}{\" \"}\r\n                total)\r\n              </p>\r\n              <div className=\"flex gap-2\">\r\n                <Button\r\n                  variant=\"neutral\"\r\n                  onClick={() => setCurrentPage((p) => Math.max(1, p - 1))}\r\n                  disabled={currentPage === 1}\r\n                  className=\"px-2\"\r\n                >\r\n                  <ChevronLeft className=\"w-4 h-4\" />\r\n                  <span className=\"hidden sm:inline\">Previous</span>\r\n                </Button>\r\n                <Button\r\n                  variant=\"neutral\"\r\n                  onClick={() =>\r\n                    setCurrentPage((p) => Math.min(totalPages, p + 1))\r\n                  }\r\n                  disabled={currentPage === totalPages}\r\n                  className=\"px-2\"\r\n                >\r\n                  <span className=\"hidden sm:inline\">Next</span>\r\n                  <ChevronRight className=\"w-4 h-4\" />\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(announcements)\\components\\CreateAnnouncementDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(announcements)\\components\\EmailStatusBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(calendar)\\components\\(actions)\\useCalendarActions.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(calendar)\\components\\(actions)\\useCalendarActions.ts:53:5\n  51 |   // 5. Initial Load\n  52 |   useEffect(() => {\n> 53 |     loadEvents();\n     |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  54 |   }, [loadEvents]);\n  55 |   const handleCreate = useCallback(\n  56 |     async (data: CreateEventInput) => {","line":53,"column":5,"nodeType":null,"endLine":53,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useEffect } from \"react\";\r\nimport { View } from \"react-big-calendar\";\r\nimport {\r\n  CalendarEvent,\r\n  CreateEventInput,\r\n  UpdateEventInput,\r\n} from \"@/lib/validations\";\r\nimport {\r\n  createCalendarEvent,\r\n  updateCalendarEvent,\r\n  deleteCalendarEvent,\r\n} from \"@/actions/(events)/event\";\r\nimport { getTeamEvents_DB } from \"@/actions/(events)/event_db\";\r\nimport toast from \"react-hot-toast\";\r\n\r\nexport function useTeamCalendar(teamId: string) {\r\n  // 1. Data State\r\n  const [events, setEvents] = useState<CalendarEvent[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // 2. Calendar View State\r\n  const [date, setDate] = useState(new Date());\r\n  const [view, setView] = useState<View>(\"month\");\r\n\r\n  // 3. Modal State\r\n  const [modal, setModal] = useState<{\r\n    isOpen: boolean;\r\n    mode: \"create\" | \"edit\";\r\n    selectedEvent: CalendarEvent | null;\r\n  }>({\r\n    isOpen: false,\r\n    mode: \"create\",\r\n    selectedEvent: null,\r\n  });\r\n\r\n  // 4. Load Events (extracted for refetch)\r\n  const loadEvents = useCallback(async () => {\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      const events = await getTeamEvents_DB(teamId);\r\n      setEvents(events);\r\n    } catch (error) {\r\n      console.error(\"Failed to load events:\", error);\r\n      setEvents([]);\r\n    }\r\n\r\n    setIsLoading(false);\r\n  }, [teamId]);\r\n\r\n  // 5. Initial Load\r\n  useEffect(() => {\r\n    loadEvents();\r\n  }, [loadEvents]);\r\n  const handleCreate = useCallback(\r\n    async (data: CreateEventInput) => {\r\n      const toastId = toast.loading(\"Creating event...\");\r\n      try {\r\n        // Map desc to description for server action\r\n        const result = await createCalendarEvent(teamId, {\r\n          title: data.title,\r\n          start: data.start,\r\n          end: data.end,\r\n          description: data.desc,\r\n        });\r\n        if (result.success) {\r\n          toast.success(\"Event created successfully!\", { id: toastId });\r\n          await loadEvents(); // Refetch canonical list\r\n        } else {\r\n          toast.error(result.error || \"Failed to create event\", {\r\n            id: toastId,\r\n          });\r\n        }\r\n      } catch (error) {\r\n        toast.error(\r\n          error instanceof Error ? error.message : \"Failed to create event\",\r\n          { id: toastId },\r\n        );\r\n      }\r\n    },\r\n    [teamId, loadEvents],\r\n  );\r\n  const handleUpdate = useCallback(\r\n    async (data: UpdateEventInput) => {\r\n      const toastId = toast.loading(\"Updating event...\");\r\n      try {\r\n        const result = await updateCalendarEvent(teamId, data);\r\n        if (result.success) {\r\n          toast.success(\"Event updated successfully!\", { id: toastId });\r\n          await loadEvents(); // Refetch canonical list\r\n        } else {\r\n          toast.error(result.error || \"Failed to update event\", {\r\n            id: toastId,\r\n          });\r\n        }\r\n      } catch (error) {\r\n        toast.error(\r\n          error instanceof Error ? error.message : \"Failed to update event\",\r\n          { id: toastId },\r\n        );\r\n      }\r\n    },\r\n    [teamId, loadEvents],\r\n  );\r\n  const handleDelete = useCallback(\r\n    async (id: string) => {\r\n      const toastId = toast.loading(\"Deleting event...\");\r\n      try {\r\n        const result = await deleteCalendarEvent(teamId, id);\r\n        if (result.success) {\r\n          toast.success(\"Event deleted successfully!\", { id: toastId });\r\n          await loadEvents(); // Refetch canonical list\r\n        } else {\r\n          toast.error(result.error || \"Failed to delete event\", {\r\n            id: toastId,\r\n          });\r\n        }\r\n      } catch (error) {\r\n        toast.error(\r\n          error instanceof Error ? error.message : \"Failed to delete event\",\r\n          { id: toastId },\r\n        );\r\n      }\r\n    },\r\n    [teamId, loadEvents],\r\n  );\r\n\r\n  // 5. Actions (Scaffolded for User Implementation)\r\n  const openCreate = useCallback(() => {\r\n    setModal({ isOpen: true, mode: \"create\", selectedEvent: null });\r\n  }, []);\r\n\r\n  const openEdit = useCallback((event: CalendarEvent) => {\r\n    setModal({ isOpen: true, mode: \"edit\", selectedEvent: event });\r\n  }, []);\r\n\r\n  const close = useCallback(() => {\r\n    setModal((prev) => ({ ...prev, isOpen: false }));\r\n  }, []);\r\n\r\n  const submit = useCallback(\r\n    async (data: CreateEventInput | UpdateEventInput) => {\r\n      close(); // Close modal before showing toasts\r\n      if (modal.mode === \"create\") {\r\n        await handleCreate(data as CreateEventInput);\r\n      } else if (modal.mode === \"edit\") {\r\n        await handleUpdate(data as UpdateEventInput);\r\n      }\r\n    },\r\n    [modal.mode, close, handleCreate, handleUpdate],\r\n  );\r\n\r\n  const remove = useCallback(\r\n    async (id: string) => {\r\n      close(); // Close modal before showing toasts\r\n      await handleDelete(id);\r\n    },\r\n    [close, handleDelete],\r\n  );\r\n\r\n  return {\r\n    // State\r\n    events,\r\n    isLoading,\r\n    date,\r\n    view,\r\n    modal,\r\n\r\n    // Setters\r\n    setDate,\r\n    setView,\r\n\r\n    // Actions\r\n    actions: {\r\n      openCreate,\r\n      openEdit,\r\n      close,\r\n      submit,\r\n      remove,\r\n    },\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(calendar)\\components\\CalendarToolbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'date' is assigned a value but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'btnActive' is assigned a value but never used.","line":40,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { View, ToolbarProps } from \"react-big-calendar\";\r\nimport { CalendarEvent } from \"@/lib/validations\";\r\nimport { ChevronDown, ChevronLeft, ChevronRight, Plus } from \"lucide-react\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/DropdownMenu\";\r\n\r\ninterface CalendarToolbarProps extends ToolbarProps<CalendarEvent> {\r\n  onAddEvent?: () => void;\r\n}\r\n\r\nexport default function CalendarToolbar(props: CalendarToolbarProps) {\r\n  const {\r\n    date,\r\n    view,\r\n    views,\r\n    label,\r\n    onView,\r\n    onNavigate,\r\n    localizer,\r\n    onAddEvent,\r\n  } = props;\r\n\r\n  const navigate = (action: \"PREV\" | \"NEXT\" | \"TODAY\") => {\r\n    onNavigate(action);\r\n  };\r\n\r\n  const currentView = view;\r\n  const availableViews = views as View[];\r\n\r\n  // Shared button styles\r\n  const btnBase =\r\n    \"relative inline-flex items-center px-4 py-2 border border-[#e5e7eb] bg-white text-sm font-semibold text-[#111827] hover:bg-[#f9fafb] focus:z-10 focus:outline-none transition-colors\";\r\n  const btnFirst = \"rounded-l-md\";\r\n  const btnLast = \"rounded-r-md\";\r\n  const btnMiddle = \"-ml-px\";\r\n  const btnActive =\r\n    \"bg-[#2563eb] text-white border-[#2563eb] hover:bg-[#1d4ed8] z-20\";\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-4 mb-4 border-b border-[#e5e7eb] pb-4\">\r\n      {/* Mobile Layout: Row 1 (Nav + View), Row 2 (Label) */}\r\n      <div className=\"md:hidden flex flex-col gap-4\">\r\n        <div className=\"flex items-center justify-between w-full\">\r\n          {/* Navigation Group - Connected Buttons */}\r\n          <div className=\"isolate inline-flex rounded-md shadow-sm border border-[#e5e7eb]\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"px-4 h-10 bg-white text-sm font-semibold text-[#111827] hover:bg-[#f9fafb] focus:z-10 focus:outline-none border-r border-[#e5e7eb] flex items-center justify-center transition-colors\"\r\n              onClick={() => navigate(\"TODAY\")}\r\n            >\r\n              Today\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              className=\"w-10 h-10 flex items-center justify-center bg-white text-[#111827] hover:bg-[#f9fafb] focus:z-10 focus:outline-none border-r border-[#e5e7eb] transition-colors\"\r\n              onClick={() => navigate(\"PREV\")}\r\n              aria-label=\"Previous range\"\r\n            >\r\n              <span className=\"text-[#111827] font-semibold text-lg leading-none flex items-center justify-center\">\r\n                &lt;\r\n              </span>\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              className=\"w-10 h-10 flex items-center justify-center bg-white text-[#111827] hover:bg-[#f9fafb] focus:z-10 focus:outline-none transition-colors\"\r\n              onClick={() => navigate(\"NEXT\")}\r\n              aria-label=\"Next range\"\r\n            >\r\n              <span className=\"text-[#111827] font-semibold text-lg leading-none flex items-center justify-center\">\r\n                &gt;\r\n              </span>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Mobile View Selector + Add Button */}\r\n          <div className=\"flex items-center gap-2\">\r\n            <DropdownMenu>\r\n              <DropdownMenuTrigger className=\"h-10 bg-white border border-[#e5e7eb] rounded-md shadow-sm hover:bg-[#f9fafb] focus:outline-none transition-all px-3 min-w-[100px]\">\r\n                <span className=\"inline-flex items-center justify-center gap-2\">\r\n                  <span className=\"capitalize text-sm font-semibold text-[#111827]\">\r\n                    {localizer.messages[currentView] || currentView}\r\n                  </span>\r\n                  <ChevronDown className=\"w-4 h-4 text-[#6b7280] shrink-0\" />\r\n                </span>\r\n              </DropdownMenuTrigger>\r\n              <DropdownMenuContent\r\n                align=\"end\"\r\n                className=\"w-[140px] border border-[#e5e7eb] rounded-md shadow-lg bg-white p-1 overflow-hidden z-50\"\r\n              >\r\n                {availableViews.map((v) => (\r\n                  <DropdownMenuItem\r\n                    key={v}\r\n                    onClick={() => onView(v)}\r\n                    className={`\r\n                    cursor-pointer px-3 py-2 font-medium capitalize rounded-sm text-sm\r\n                    hover:bg-[#f3f4f6] focus:bg-[#f3f4f6]\r\n                    ${currentView === v ? \"bg-[#eff6ff] text-[#2563eb]\" : \"text-[#111827]\"}\r\n                  `}\r\n                  >\r\n                    {localizer.messages[v] || v}\r\n                  </DropdownMenuItem>\r\n                ))}\r\n              </DropdownMenuContent>\r\n            </DropdownMenu>\r\n            {onAddEvent && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={onAddEvent}\r\n                className=\"h-10 px-3 bg-[#2563eb] text-white border border-[#2563eb] rounded-md shadow-sm hover:bg-[#1d4ed8] focus:outline-none focus:ring-2 focus:ring-[#2563eb] focus:ring-offset-2 transition-all flex items-center justify-center gap-1.5 text-sm font-semibold\"\r\n                aria-label=\"Add event\"\r\n              >\r\n                <Plus className=\"w-4 h-4 shrink-0\" />\r\n                <span className=\"hidden sm:inline\">Add Event</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Label (Mobile) */}\r\n        <h2\r\n          className=\"text-center font-bold text-lg text-gray-900 uppercase tracking-tight\"\r\n          aria-live=\"polite\"\r\n        >\r\n          {label}\r\n        </h2>\r\n      </div>\r\n\r\n      {/* Desktop Layout */}\r\n      <div className=\"hidden md:flex items-center justify-between w-full\">\r\n        {/* Navigation Group */}\r\n        <div className=\"isolate inline-flex rounded-md shadow-sm\">\r\n          <button\r\n            type=\"button\"\r\n            className={`${btnBase} ${btnFirst}`}\r\n            onClick={() => navigate(\"TODAY\")}\r\n          >\r\n            Today\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            className={`${btnBase} ${btnMiddle} px-2`}\r\n            onClick={() => navigate(\"PREV\")}\r\n            aria-label=\"Previous range\"\r\n          >\r\n            <ChevronLeft className=\"w-5 h-5\" />\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            className={`${btnBase} ${btnLast} ${btnMiddle} px-2`}\r\n            onClick={() => navigate(\"NEXT\")}\r\n            aria-label=\"Next range\"\r\n          >\r\n            <ChevronRight className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Label (Desktop) */}\r\n        <h2\r\n          className=\"rbc-toolbar-label font-bold text-xl text-[#111827] uppercase tracking-tight\"\r\n          aria-live=\"polite\"\r\n        >\r\n          {label}\r\n        </h2>\r\n\r\n        {/* View Selector Dropdown + Add Button (Desktop - matches mobile) */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger className=\"h-10 bg-white border border-[#e5e7eb] rounded-md shadow-sm hover:bg-[#f9fafb] focus:outline-none transition-all px-4 min-w-[120px]\">\r\n              <span className=\"inline-flex items-center justify-center gap-2\">\r\n                <span className=\"capitalize text-sm font-semibold text-[#111827]\">\r\n                  {localizer.messages[currentView] || currentView}\r\n                </span>\r\n                <ChevronDown className=\"w-4 h-4 text-[#6b7280] shrink-0\" />\r\n              </span>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent\r\n              align=\"end\"\r\n              className=\"w-[140px] border border-[#e5e7eb] rounded-md shadow-lg bg-white p-1 overflow-hidden z-50\"\r\n            >\r\n              {availableViews.map((v) => (\r\n                <DropdownMenuItem\r\n                  key={v}\r\n                  onClick={() => onView(v)}\r\n                  className={`\r\n                    cursor-pointer px-3 py-2 font-medium capitalize rounded-sm text-sm\r\n                    hover:bg-[#f3f4f6] focus:bg-[#f3f4f6]\r\n                    ${currentView === v ? \"bg-[#eff6ff] text-[#2563eb]\" : \"text-[#111827]\"}\r\n                  `}\r\n                >\r\n                  {localizer.messages[v] || v}\r\n                </DropdownMenuItem>\r\n              ))}\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n          {onAddEvent && (\r\n            <button\r\n              type=\"button\"\r\n              onClick={onAddEvent}\r\n              className=\"h-10 px-4 bg-[#2563eb] text-white border border-[#2563eb] rounded-md shadow-sm hover:bg-[#1d4ed8] focus:outline-none focus:ring-2 focus:ring-[#2563eb] focus:ring-offset-2 transition-all flex items-center justify-center gap-2 text-sm font-semibold\"\r\n              aria-label=\"Add event\"\r\n            >\r\n              <Plus className=\"w-4 h-4 shrink-0\" />\r\n              Add Event\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(calendar)\\components\\EventModal.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(calendar)\\components\\EventModal.tsx:50:7\n  48 |   useEffect(() => {\n  49 |     if (mode === \"edit\" && event) {\n> 50 |       setTitle(event.title);\n     |       ^^^^^^^^ Avoid calling setState() directly within an effect\n  51 |       setStartStr(format(event.start, \"yyyy-MM-dd'T'HH:mm\"));\n  52 |       setEndStr(format(event.end, \"yyyy-MM-dd'T'HH:mm\"));\n  53 |       setDesc(event.desc || \"\");","line":50,"column":7,"nodeType":null,"endLine":50,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogOverlay,\r\n} from \"@/components/ui/Dialog\";\r\nimport { Input } from \"@/components/ui/Input\";\r\nimport { Button } from \"@/components/ui/Button\";\r\nimport {\r\n  CalendarEvent,\r\n  CreateEventInput,\r\n  UpdateEventInput,\r\n  CreateEventSchema,\r\n  UpdateEventSchema,\r\n} from \"@/lib/validations\";\r\nimport { format } from \"date-fns\";\r\nimport { inter, instrumentSerif } from \"@/app/fonts\";\r\nimport toast from \"react-hot-toast\";\r\n\r\ninterface EventModalProps {\r\n  isOpen: boolean;\r\n  mode: \"create\" | \"edit\";\r\n  event: CalendarEvent | null;\r\n  onClose: () => void;\r\n  onSubmit: (data: CreateEventInput | UpdateEventInput) => Promise<void>;\r\n  onDelete?: (id: string) => Promise<void>;\r\n}\r\n\r\nexport default function EventModal({\r\n  isOpen,\r\n  mode,\r\n  event,\r\n  onClose,\r\n  onSubmit,\r\n  onDelete,\r\n}: EventModalProps) {\r\n  const [title, setTitle] = useState(\"\");\r\n  const [startStr, setStartStr] = useState(\"\");\r\n  const [endStr, setEndStr] = useState(\"\");\r\n  const [desc, setDesc] = useState(\"\");\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n\r\n  // Sync state with event data when editing\r\n  useEffect(() => {\r\n    if (mode === \"edit\" && event) {\r\n      setTitle(event.title);\r\n      setStartStr(format(event.start, \"yyyy-MM-dd'T'HH:mm\"));\r\n      setEndStr(format(event.end, \"yyyy-MM-dd'T'HH:mm\"));\r\n      setDesc(event.desc || \"\");\r\n    } else {\r\n      setTitle(\"\");\r\n      setStartStr(\"\");\r\n      setEndStr(\"\");\r\n      setDesc(\"\");\r\n    }\r\n    setErrors({});\r\n  }, [mode, event, isOpen]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setErrors({});\r\n\r\n    if (mode === \"create\") {\r\n      const data = {\r\n        title,\r\n        start: new Date(startStr),\r\n        end: endStr ? new Date(endStr) : undefined, // Allow empty end date\r\n        desc: desc || undefined,\r\n      };\r\n\r\n      // Validate with Zod\r\n      const result = CreateEventSchema.safeParse(data);\r\n      if (!result.success) {\r\n        const fieldErrors: Record<string, string> = {};\r\n        result.error.issues.forEach((err) => {\r\n          const path = err.path.join(\".\");\r\n          fieldErrors[path] = err.message;\r\n        });\r\n        setErrors(fieldErrors);\r\n        toast.error(\"Please fix the validation errors\");\r\n        return;\r\n      }\r\n\r\n      await onSubmit(result.data);\r\n    } else {\r\n      const data = {\r\n        id: event!.id,\r\n        title,\r\n        start: new Date(startStr),\r\n        end: endStr ? new Date(endStr) : undefined, // Allow empty end date\r\n        desc: desc || undefined,\r\n        googleEventId: event!.googleEventId,\r\n      };\r\n\r\n      // Validate with Zod\r\n      const result = UpdateEventSchema.safeParse(data);\r\n      if (!result.success) {\r\n        const fieldErrors: Record<string, string> = {};\r\n        result.error.issues.forEach((err) => {\r\n          const path = err.path.join(\".\");\r\n          fieldErrors[path] = err.message;\r\n        });\r\n        setErrors(fieldErrors);\r\n        toast.error(\"Please fix the validation errors\");\r\n        return;\r\n      }\r\n\r\n      await onSubmit(result.data);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogOverlay className=\" bg-black/30\">\r\n        <DialogContent className=\"p-8 rounded-xl outline-4 outline-black overflow-visible\">\r\n          <DialogHeader className=\"p-0\">\r\n            <DialogTitle\r\n              className={`${instrumentSerif.className} font-base font-bold text-4xl`}\r\n            >\r\n              {mode === \"create\" ? \"📅 Add New Event\" : \"📝 Edit Event\"}\r\n            </DialogTitle>\r\n            <DialogDescription\r\n              className={`${inter.className} text-md font-base text-foreground`}\r\n            >\r\n              {mode === \"create\"\r\n                ? \"Enter the details for the new team event.\"\r\n                : \"Update the details of this event.\"}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <form onSubmit={handleSubmit} className=\"grid gap-4 py-4\">\r\n            <div className=\"grid gap-2\">\r\n              <label className=\"text-sm font-medium\">Event Title</label>\r\n              <Input\r\n                value={title}\r\n                onChange={(e) => setTitle(e.target.value)}\r\n                placeholder=\"e.g. Design Sprint\"\r\n                className={errors.title ? \"border-red-500\" : \"\"}\r\n              />\r\n              {errors.title && (\r\n                <p className=\"text-sm text-red-500\">{errors.title}</p>\r\n              )}\r\n            </div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div className=\"grid gap-2\">\r\n                <label className=\"text-sm font-medium\">Start Time</label>\r\n                <Input\r\n                  type=\"datetime-local\"\r\n                  value={startStr}\r\n                  onChange={(e) => setStartStr(e.target.value)}\r\n                  className={errors.start ? \"border-red-500\" : \"\"}\r\n                />\r\n                {errors.start && (\r\n                  <p className=\"text-sm text-red-500\">{errors.start}</p>\r\n                )}\r\n              </div>\r\n              <div className=\"grid gap-2\">\r\n                <label className=\"text-sm font-medium\">End Time</label>\r\n                <Input\r\n                  type=\"datetime-local\"\r\n                  value={endStr}\r\n                  onChange={(e) => setEndStr(e.target.value)}\r\n                  className={errors.end ? \"border-red-500\" : \"\"}\r\n                />\r\n                {errors.end && (\r\n                  <p className=\"text-sm text-red-500\">{errors.end}</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n            <div className=\"grid gap-2\">\r\n              <label className=\"text-sm font-medium\">\r\n                Description (Optional)\r\n              </label>\r\n              <Input\r\n                value={desc}\r\n                onChange={(e) => setDesc(e.target.value)}\r\n                placeholder=\"Short description\"\r\n                className={errors.desc ? \"border-red-500\" : \"\"}\r\n              />\r\n              {errors.desc && (\r\n                <p className=\"text-sm text-red-500\">{errors.desc}</p>\r\n              )}\r\n            </div>\r\n\r\n            <DialogFooter className=\"flex mt-4 justify-between items-center md:justify-between\">\r\n              {mode === \"edit\" && onDelete && (\r\n                <Button\r\n                  className=\"bg-red-500 hover:bg-red-600\"\r\n                  type=\"button\"\r\n                  onClick={() => onDelete(event!.id)}\r\n                >\r\n                  Delete\r\n                </Button>\r\n              )}\r\n              <div className=\"place-content-end grid grid-cols-2 w-full sm:flex gap-2 ml-auto\">\r\n                <Button\r\n                  type=\"button\"\r\n                  onClick={onClose}\r\n                  className=\"bg-slate-100 text-black\"\r\n                >\r\n                  Cancel\r\n                </Button>\r\n                <Button type=\"submit\">\r\n                  {mode === \"create\" ? \"Add Event\" : \"Save Changes\"}\r\n                </Button>\r\n              </div>\r\n            </DialogFooter>\r\n          </form>\r\n        </DialogContent>\r\n      </DialogOverlay>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(calendar)\\components\\TeamCalendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(calendar)\\components\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(members)\\components\\AddMemberModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(members)\\components\\EditMemberModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(members)\\components\\ImportMembersModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertDialogAction' is defined but never used.","line":5,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":83,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useState, useRef } from \"react\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogDescription,\r\n} from \"@/components/ui/AlertDialog\";\r\nimport { Upload, FileText, AlertCircle } from \"lucide-react\";\r\nimport { importMembersToTeam } from \"@/actions/members\";\r\nimport toast from \"react-hot-toast\";\r\n\r\ninterface ImportMembersModalProps {\r\n  teamId: string;\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onSuccess?: () => void;\r\n}\r\n\r\ninterface ImportResult {\r\n  success: boolean;\r\n  added: number;\r\n  failed: number;\r\n  errors?: string[];\r\n}\r\n\r\nfunction ImportMembersModal({\r\n  teamId,\r\n  open,\r\n  onOpenChange,\r\n  onSuccess,\r\n}: ImportMembersModalProps) {\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\r\n  const [fileError, setFileError] = useState<string | undefined>(undefined);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      if (file.type !== \"text/csv\" && !file.name.endsWith(\".csv\")) {\r\n        setFileError(\"Please select a CSV file\");\r\n        setSelectedFile(null);\r\n        return;\r\n      }\r\n      setSelectedFile(file);\r\n      setFileError(undefined); // Clear error when valid file selected\r\n    }\r\n  };\r\n\r\n  const parseCSV = async (\r\n    file: File,\r\n  ): Promise<Array<{ email: string; full_name?: string }>> => {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        try {\r\n          const text = e.target?.result as string;\r\n          const lines = text\r\n            .split(\"\\n\")\r\n            .map((line) => line.trim())\r\n            .filter((line) => line.length > 0); // Remove empty lines\r\n\r\n          if (lines.length <= 1) {\r\n            // Only header or empty file\r\n            resolve([]);\r\n            return;\r\n          }\r\n\r\n          // Skip header row\r\n          const dataLines = lines.slice(1);\r\n\r\n          const members = dataLines.map((line) => {\r\n            const [email, full_name] = line.split(\",\").map((s) => s.trim());\r\n            return { email, full_name: full_name || undefined };\r\n          });\r\n\r\n          resolve(members);\r\n        } catch (error) {\r\n          reject(new Error(\"Failed to parse CSV file\"));\r\n        }\r\n      };\r\n      reader.onerror = () => reject(new Error(\"Failed to read file\"));\r\n      reader.readAsText(file);\r\n    });\r\n  };\r\n\r\n  const handleImport = async () => {\r\n    if (!selectedFile) {\r\n      setFileError(\"Please select a file to import\");\r\n      return; // Don't close modal\r\n    }\r\n\r\n    setFileError(undefined);\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      toast.loading(\"Parsing CSV file...\");\r\n      const parsedMembers = await parseCSV(selectedFile);\r\n\r\n      // Filter out invalid entries (empty email)\r\n      const members = parsedMembers.filter((m) => m.email && m.email.trim());\r\n\r\n      if (members.length === 0) {\r\n        toast.dismiss();\r\n        setFileError(\r\n          \"No valid members found in CSV. Please check the file format.\",\r\n        );\r\n        setIsLoading(false);\r\n        return; // Don't close modal\r\n      }\r\n\r\n      // Show warning if some entries were skipped\r\n      if (members.length < parsedMembers.length) {\r\n        const skipped = parsedMembers.length - members.length;\r\n        toast.dismiss();\r\n        toast(\r\n          `Skipped ${skipped} invalid ${skipped === 1 ? \"entry\" : \"entries\"}. Importing ${members.length} members...`,\r\n          { icon: \"⚠️\", duration: 3000 },\r\n        );\r\n      }\r\n\r\n      toast.dismiss();\r\n      toast.loading(`Importing ${members.length} members...`);\r\n\r\n      const result = await importMembersToTeam(teamId, members);\r\n\r\n      toast.dismiss();\r\n\r\n      if (result.success) {\r\n        const { added, failed } = result as ImportResult;\r\n        if (failed > 0) {\r\n          toast.success(\r\n            `Imported ${added} members successfully. ${failed} failed.`,\r\n            { duration: 5000 },\r\n          );\r\n        } else {\r\n          toast.success(`Successfully imported ${added} members!`);\r\n        }\r\n        setSelectedFile(null);\r\n        if (fileInputRef.current) fileInputRef.current.value = \"\";\r\n        setFileError(undefined);\r\n        onOpenChange(false); // Only close on success\r\n        onSuccess?.();\r\n      } else {\r\n        setFileError(result.error || \"Failed to import members\");\r\n        // Don't close modal - let user try again\r\n      }\r\n    } catch (error) {\r\n      toast.dismiss();\r\n      setFileError(\r\n        error instanceof Error ? error.message : \"Failed to import members\",\r\n      );\r\n      // Don't close modal on error\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\r\n      <AlertDialogContent className=\"p-4 left-4 right-4 translate-x-0 sm:left-[50%] sm:right-auto sm:translate-x-[-50%] max-w-md sm:m-0 sm:w-full\">\r\n        <AlertDialogHeader className=\"p-1\">\r\n          <AlertDialogTitle className=\"flex items-center gap-2\">\r\n            <Upload className=\"w-6 h-6 text-blue-600\" />\r\n            Import Members\r\n          </AlertDialogTitle>\r\n          <AlertDialogDescription className=\"text-sm text-gray-600\">\r\n            Upload a CSV file with columns: email, full_name\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div>\r\n            <div\r\n              className={`border-2 border-dashed rounded-lg p-6 text-center ${\r\n                fileError ? \"border-red-300\" : \"border-gray-300\"\r\n              }`}\r\n            >\r\n              <input\r\n                ref={fileInputRef}\r\n                type=\"file\"\r\n                accept=\".csv\"\r\n                onChange={handleFileSelect}\r\n                className=\"hidden\"\r\n                id=\"csv-upload\"\r\n              />\r\n              <label\r\n                htmlFor=\"csv-upload\"\r\n                className=\"cursor-pointer flex flex-col items-center gap-2\"\r\n              >\r\n                {selectedFile ? (\r\n                  <>\r\n                    <FileText className=\"w-12 h-12 text-blue-500\" />\r\n                    <p className=\"text-sm font-medium text-gray-700\">\r\n                      {selectedFile.name}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                      Click to change file\r\n                    </p>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Upload className=\"w-12 h-12 text-gray-400\" />\r\n                    <p className=\"text-sm font-medium text-gray-700\">\r\n                      Click to upload CSV\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">or drag and drop</p>\r\n                  </>\r\n                )}\r\n              </label>\r\n            </div>\r\n            {fileError && (\r\n              <p className=\"text-sm text-red-600 mt-1\">{fileError}</p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 flex gap-2\">\r\n            <AlertCircle className=\"w-5 h-5 text-blue-600 shrink-0 mt-0.5\" />\r\n            <div className=\"text-xs text-blue-800\">\r\n              <p className=\"font-medium mb-1\">CSV Format:</p>\r\n              <code className=\"bg-white px-2 py-1 rounded text-xs block\">\r\n                email,full_name\r\n                <br />\r\n                john@example.com,John Doe\r\n                <br />\r\n                jane@example.com,Jane Smith\r\n              </code>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <AlertDialogFooter className=\"flex flex-row\">\r\n          <AlertDialogCancel className=\"flex-1 sm:flex-none\">\r\n            Cancel\r\n          </AlertDialogCancel>\r\n          <button\r\n            type=\"button\"\r\n            className=\"px-4 py-2 border-3 border-black bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2\"\r\n            disabled={isLoading}\r\n            onClick={handleImport}\r\n          >\r\n            <Upload className=\"w-4 h-4\" />\r\n            {isLoading ? \"Importing...\" : \"Import Members\"}\r\n          </button>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n  );\r\n}\r\n\r\nexport default ImportMembersModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(members)\\components\\MemberActionsMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(members)\\components\\MemberTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":82,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":82,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { DataTable, ColumnDef } from \"@/components/ui/DataTable\";\r\nimport { getMembersForTeam, removeMemberFromTeam } from \"@/actions/members\";\r\nimport { SearchInput } from \"@/app/dashboard/components/team-table/SearchInput\";\r\nimport { Pagination } from \"@/app/dashboard/components/team-table/Pagination\";\r\nimport { MemberActionsMenu } from \"./MemberActionsMenu\";\r\nimport ConfirmationModal from \"@/app/dashboard/components/team-table/ConfirmationModal\";\r\nimport EditMemberModal, { Member } from \"./EditMemberModal\";\r\nimport AddMemberModal from \"./AddMemberModal\";\r\nimport ImportMembersModal from \"./ImportMembersModal\";\r\nimport { MemberTableSkeleton } from \"./MemberTableSkeleton\";\r\nimport toast from \"react-hot-toast\";\r\n\r\nimport { UserPlus, Upload } from \"lucide-react\";\r\n\r\ninterface MemberTableProps {\r\n  teamId: string;\r\n}\r\n\r\nexport default function MemberTable({ teamId }: MemberTableProps) {\r\n  const [members, setMembers] = React.useState<Member[]>([]);\r\n  const [isLoading, setIsLoading] = React.useState(true);\r\n  const [deleteModalOpen, setDeleteModalOpen] = React.useState(false);\r\n  const [memberToRemove, setMemberToRemove] = React.useState<Member | null>(\r\n    null,\r\n  );\r\n  const [editModalOpen, setEditModalOpen] = React.useState(false);\r\n  const [memberToEdit, setMemberToEdit] = React.useState<Member | null>(null);\r\n  const [addModalOpen, setAddModalOpen] = React.useState(false);\r\n  const [importModalOpen, setImportModalOpen] = React.useState(false);\r\n\r\n  // Fetch members on mount\r\n  const fetchMembers = React.useCallback(async () => {\r\n    setIsLoading(true);\r\n    const result = await getMembersForTeam(teamId);\r\n    if (result.success && result.members) {\r\n      setMembers(result.members as Member[]);\r\n    }\r\n    setIsLoading(false);\r\n  }, [teamId]);\r\n\r\n  React.useEffect(() => {\r\n    fetchMembers();\r\n  }, [fetchMembers]);\r\n\r\n  const handleRemoveClick = (member: Member) => {\r\n    setMemberToRemove(member);\r\n    setDeleteModalOpen(true);\r\n  };\r\n\r\n  const handleEditClick = (member: Member) => {\r\n    setMemberToEdit(member);\r\n    setEditModalOpen(true);\r\n  };\r\n\r\n  const handleConfirmRemove = async () => {\r\n    if (!memberToRemove) return;\r\n\r\n    // Immediate update\r\n    const previousMembers = members;\r\n    setMembers((prev) => prev.filter((m) => m.id !== memberToRemove.id));\r\n    setDeleteModalOpen(false);\r\n    setMemberToRemove(null);\r\n\r\n    toast.loading(\r\n      `Removing ${memberToRemove.full_name || memberToRemove.email}...`,\r\n    );\r\n\r\n    try {\r\n      const result = await removeMemberFromTeam(teamId, memberToRemove.id);\r\n      toast.dismiss();\r\n\r\n      if (result.success) {\r\n        toast.success(\"Member removed successfully!\");\r\n      } else {\r\n        // Rollback on error\r\n        setMembers(previousMembers);\r\n        toast.error(result.error || \"Failed to remove member\");\r\n      }\r\n    } catch (error) {\r\n      // Rollback on error\r\n      setMembers(previousMembers);\r\n      toast.dismiss();\r\n      toast.error(\"Failed to remove member\");\r\n    }\r\n  };\r\n\r\n  const columns: ColumnDef<Member>[] = [\r\n    {\r\n      key: \"full_name\",\r\n      header: \"Name\",\r\n      className: \"w-[250px]\",\r\n      render: (member) => (\r\n        <div className=\"flex items-center gap-3\">\r\n          <span className=\"font-medium text-gray-900\">\r\n            {member.full_name || \"—\"}\r\n          </span>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: \"email\",\r\n      header: \"Email\",\r\n      className: \"\",\r\n      render: (member) => <div className=\"text-gray-600\">{member.email}</div>,\r\n    },\r\n    {\r\n      key: \"added_at\",\r\n      header: \"Added\",\r\n      className: \"text-center\",\r\n      render: (member) => (\r\n        <div className=\"text-gray-600\">\r\n          {member.added_at\r\n            ? new Date(member.added_at).toLocaleDateString()\r\n            : \"—\"}\r\n        </div>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      {isLoading ? (\r\n        <MemberTableSkeleton />\r\n      ) : (\r\n        <div className=\"flex-1 flex flex-col\">\r\n          <DataTable<Member>\r\n            data={members}\r\n            columns={columns}\r\n            searchKey=\"full_name\"\r\n            searchPlaceholder=\"Search members...\"\r\n            emptyMessage=\"No members in this team yet.\"\r\n            headerActions={\r\n              <>\r\n                <button\r\n                  onClick={() => setAddModalOpen(true)}\r\n                  className=\"px-3 md:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2\"\r\n                >\r\n                  <UserPlus className=\"w-5 h-5\" />\r\n                  <span className=\"hidden md:inline\">Add Member</span>\r\n                </button>\r\n                <button\r\n                  onClick={() => setImportModalOpen(true)}\r\n                  className=\"px-3 md:px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium flex items-center gap-2\"\r\n                >\r\n                  <Upload className=\"w-5 h-5\" />\r\n                  <span className=\"hidden md:inline\">Import</span>\r\n                </button>\r\n              </>\r\n            }\r\n            renderActions={(member) => (\r\n              <MemberActionsMenu\r\n                member={member}\r\n                onEdit={() => handleEditClick(member)}\r\n                onRemove={() => handleRemoveClick(member)}\r\n              />\r\n            )}\r\n            SearchComponent={SearchInput}\r\n            PaginationComponent={Pagination}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      <ConfirmationModal\r\n        open={deleteModalOpen}\r\n        onOpenChange={setDeleteModalOpen}\r\n        description=\"This will remove the member from this team. They can be added back later.\"\r\n        onConfirm={handleConfirmRemove}\r\n      />\r\n\r\n      <EditMemberModal\r\n        member={memberToEdit}\r\n        open={editModalOpen}\r\n        onOpenChange={setEditModalOpen}\r\n      />\r\n\r\n      <AddMemberModal\r\n        teamId={teamId}\r\n        open={addModalOpen}\r\n        onOpenChange={setAddModalOpen}\r\n        onSuccess={fetchMembers}\r\n      />\r\n\r\n      <ImportMembersModal\r\n        teamId={teamId}\r\n        open={importModalOpen}\r\n        onOpenChange={setImportModalOpen}\r\n        onSuccess={fetchMembers}\r\n      />\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(members)\\components\\MemberTableSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\(members)\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\TeamDashboardClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\TeamHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\dashboard\\teams\\[teamsId]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\fonts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\hero\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\auth\\callback\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\email\\announcement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\ui\\AlertDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\ui\\DataTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[969,972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[969,972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'searchPlaceholder' is assigned a value but never used.","line":47,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"@/components/ui/Table\";\r\n\r\nexport interface ColumnDef<T> {\r\n  key: string;\r\n  header: string;\r\n  className?: string;\r\n  render?: (item: T) => React.ReactNode;\r\n}\r\n\r\nexport interface DataTableProps<T> {\r\n  data: T[];\r\n  columns: ColumnDef<T>[];\r\n  searchKey: keyof T;\r\n  searchPlaceholder?: string;\r\n  emptyMessage?: string;\r\n  onRowClick?: (item: T) => void;\r\n  renderActions?: (item: T) => React.ReactNode;\r\n  itemsPerPage?: number;\r\n  headerActions?: React.ReactNode;\r\n  SearchComponent?: React.ComponentType<{\r\n    value: string;\r\n    onChange: (value: string) => void;\r\n  }>;\r\n  PaginationComponent?: React.ComponentType<{\r\n    totalCount: number;\r\n    canPrevious: boolean;\r\n    canNext: boolean;\r\n    onPrevious: () => void;\r\n    onNext: () => void;\r\n  }>;\r\n}\r\n\r\nexport function DataTable<T extends Record<string, any>>({\r\n  data,\r\n  columns,\r\n  searchKey,\r\n  searchPlaceholder = \"Search...\",\r\n  emptyMessage = \"No results found.\",\r\n  onRowClick,\r\n  renderActions,\r\n  itemsPerPage = 5,\r\n  headerActions,\r\n  SearchComponent,\r\n  PaginationComponent,\r\n}: DataTableProps<T>) {\r\n  const [searchValue, setSearchValue] = React.useState(\"\");\r\n  const [currentPage, setCurrentPage] = React.useState(1);\r\n\r\n  // Filter data based on search\r\n  const filteredData = React.useMemo(() => {\r\n    if (!searchValue) return data;\r\n    return data.filter((item) => {\r\n      const value = item[searchKey];\r\n      if (typeof value === \"string\") {\r\n        return value.toLowerCase().includes(searchValue.toLowerCase());\r\n      }\r\n      return false;\r\n    });\r\n  }, [data, searchValue, searchKey]);\r\n\r\n  // Paginate filtered data\r\n  const totalPages = Math.ceil(filteredData.length / itemsPerPage);\r\n  const paginatedData = React.useMemo(() => {\r\n    const start = (currentPage - 1) * itemsPerPage;\r\n    return filteredData.slice(start, start + itemsPerPage);\r\n  }, [filteredData, currentPage, itemsPerPage]);\r\n\r\n  // Reset page when search changes\r\n  React.useEffect(() => {\r\n    setCurrentPage(1);\r\n  }, [searchValue]);\r\n\r\n  return (\r\n    <div className=\"w-full h-full flex flex-col\">\r\n      <div className=\"flex flex-col gap-4 flex-shrink-0\">\r\n        {SearchComponent && (\r\n          <div className=\"flex items-center justify-between gap-4\">\r\n            <SearchComponent value={searchValue} onChange={setSearchValue} />\r\n            {headerActions && (\r\n              <div className=\"flex items-center gap-2\">{headerActions}</div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"rounded-xl border border-gray-200 overflow-hidden flex-1 min-h-0\">\r\n          <Table>\r\n            <TableHeader>\r\n              <TableRow>\r\n                {columns.map((column) => (\r\n                  <TableHead key={column.key} className={column.className}>\r\n                    <span className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">\r\n                      {column.header}\r\n                    </span>\r\n                  </TableHead>\r\n                ))}\r\n                {renderActions && (\r\n                  <TableHead className=\"w-[70px] text-right\">\r\n                    <span className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">\r\n                      Actions\r\n                    </span>\r\n                  </TableHead>\r\n                )}\r\n              </TableRow>\r\n            </TableHeader>\r\n            <TableBody>\r\n              {paginatedData.length ? (\r\n                paginatedData.map((item, index) => (\r\n                  <TableRow\r\n                    key={item.id || index}\r\n                    onClick={onRowClick ? () => onRowClick(item) : undefined}\r\n                    className={onRowClick ? \"cursor-pointer\" : \"\"}\r\n                  >\r\n                    {columns.map((column) => (\r\n                      <TableCell key={column.key} className={column.className}>\r\n                        {column.render\r\n                          ? column.render(item)\r\n                          : String(item[column.key] || \"\")}\r\n                      </TableCell>\r\n                    ))}\r\n                    {renderActions && (\r\n                      <TableCell className=\"text-right\">\r\n                        {renderActions(item)}\r\n                      </TableCell>\r\n                    )}\r\n                  </TableRow>\r\n                ))\r\n              ) : (\r\n                <TableRow>\r\n                  <TableCell\r\n                    colSpan={columns.length + (renderActions ? 1 : 0)}\r\n                    className=\"h-24 text-center text-gray-500\"\r\n                  >\r\n                    {emptyMessage}\r\n                  </TableCell>\r\n                </TableRow>\r\n              )}\r\n            </TableBody>\r\n          </Table>\r\n        </div>\r\n      </div>\r\n\r\n      {PaginationComponent && (\r\n        <PaginationComponent\r\n          totalCount={filteredData.length}\r\n          canPrevious={currentPage > 1}\r\n          canNext={currentPage < totalPages}\r\n          onPrevious={() => setCurrentPage((p) => Math.max(1, p - 1))}\r\n          onNext={() => setCurrentPage((p) => Math.min(totalPages, p + 1))}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\ui\\Dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\ui\\DropdownMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\ui\\Input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\ui\\RichTextEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\ui\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\ui\\Table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\components\\ui\\Toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\lib\\calendar-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\lib\\google-calendar.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\lib\\resend.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\lib\\validations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\lucide-react.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\postcss.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\prisma.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\proxy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\public\\fonts.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Archivo' is defined but never used.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Inter, Archivo, Instrument_Serif } from \"next/font/google\";\r\n\r\nexport const inter = Inter({\r\n  subsets: [\"latin\"],\r\n  variable: \"--font-inter\",\r\n  display: \"swap\",\r\n});\r\n\r\nexport const instrumentSerif = Instrument_Serif({\r\n  subsets: [\"latin\"],\r\n  weight: \"400\",\r\n  variable: \"--font-display\",\r\n  display: \"swap\",\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\supabase\\functions\\store-google-refresh\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'serve' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2169,2172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2169,2172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { serve } from \"https://deno.land/std@0.170.0/http/server.ts\";\r\n\r\n// Using Deno.serve per guidelines\r\nDeno.serve(async (req: Request) => {\r\n  try {\r\n    // Only allow POST\r\n    if (req.method !== \"POST\") {\r\n      return new Response(\r\n        JSON.stringify({ success: false, message: \"Method not allowed\" }),\r\n        { status: 405, headers: { \"Content-Type\": \"application/json\" } }\r\n      );\r\n    }\r\n\r\n    const body = await req.json().catch(() => null);\r\n    if (!body) {\r\n      return new Response(\r\n        JSON.stringify({ success: false, message: \"Invalid JSON body\" }),\r\n        { status: 400, headers: { \"Content-Type\": \"application/json\" } }\r\n      );\r\n    }\r\n\r\n    const { userId, googleRefreshToken, email, fullName, avatarUrl } = body;\r\n    if (!userId) {\r\n      return new Response(\r\n        JSON.stringify({ success: false, message: \"userId is required\" }),\r\n        { status: 400, headers: { \"Content-Type\": \"application/json\" } }\r\n      );\r\n    }\r\n\r\n    // Build SQL parameters safely\r\n    // Use Supabase DB URL to call Postgres directly\r\n    const dbUrl = Deno.env.get(\"SUPABASE_DB_URL\");\r\n    if (!dbUrl) {\r\n      return new Response(\r\n        JSON.stringify({\r\n          success: false,\r\n          message: \"Database URL not configured\",\r\n        }),\r\n        { status: 500, headers: { \"Content-Type\": \"application/json\" } }\r\n      );\r\n    }\r\n\r\n    // Use fetch to call Postgres via connection string -- Use pg client would require npm; instead use RESTful SQL via Supabase REST? Not available. Instead use Postgres via Deno Postgres driver is not allowed. But Supabase provides REST admin via /rest/v1? We'll use the Supabase Admin REST endpoint using SUPABASE_URL and SERVICE_ROLE_KEY\r\n\r\n    const supabaseUrl = Deno.env.get(\"SUPABASE_URL\");\r\n    const serviceKey = Deno.env.get(\"SUPABASE_SERVICE_ROLE_KEY\");\r\n    if (!supabaseUrl || !serviceKey) {\r\n      return new Response(\r\n        JSON.stringify({\r\n          success: false,\r\n          message: \"Supabase env vars missing\",\r\n        }),\r\n        { status: 500, headers: { \"Content-Type\": \"application/json\" } }\r\n      );\r\n    }\r\n\r\n    // Upsert the profile\r\n    const profilePayload: any = { id: userId };\r\n    if (email !== undefined) profilePayload.email = email;\r\n    if (fullName !== undefined) profilePayload.full_name = fullName;\r\n    if (avatarUrl !== undefined) profilePayload.avatar_url = avatarUrl;\r\n    if (googleRefreshToken !== undefined)\r\n      profilePayload.google_refresh_token = googleRefreshToken;\r\n\r\n    // Build PATCH (upsert) request to profiles table via Supabase REST\r\n    // Use POST with Prefer: resolution=merge-duplicates for upsert on conflict\r\n\r\n    const res = await fetch(`${supabaseUrl}/rest/v1/profiles?on_conflict=id`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        apikey: serviceKey,\r\n        Authorization: `Bearer ${serviceKey}`,\r\n        Prefer: \"resolution=merge-duplicates\",\r\n      },\r\n      body: JSON.stringify(profilePayload),\r\n    });\r\n\r\n    if (!res.ok) {\r\n      const text = await res.text();\r\n      return new Response(\r\n        JSON.stringify({\r\n          success: false,\r\n          message: \"Database request failed\",\r\n          detail: text,\r\n        }),\r\n        { status: 500, headers: { \"Content-Type\": \"application/json\" } }\r\n      );\r\n    }\r\n\r\n    return new Response(\r\n      JSON.stringify({ success: true, message: \"Token stored successfully\" }),\r\n      { status: 200, headers: { \"Content-Type\": \"application/json\" } }\r\n    );\r\n  } catch (err) {\r\n    console.error(err);\r\n    return new Response(\r\n      JSON.stringify({\r\n        success: false,\r\n        message: \"Internal server error\",\r\n        error: String(err),\r\n      }),\r\n      { status: 500, headers: { \"Content-Type\": \"application/json\" } }\r\n    );\r\n  }\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\utils\\auth-helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\utils\\cn-helper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\utils\\prisma\\prisma.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\utils\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\utils\\supabase\\proxy.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":56,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createServerClient } from \"@supabase/ssr\";\r\nimport { NextResponse, type NextRequest } from \"next/server\";\r\n\r\nexport async function updateSession(request: NextRequest) {\r\n  let supabaseResponse = NextResponse.next({\r\n    request,\r\n  });\r\n\r\n  // With Fluid compute, don't put this client in a global environment\r\n  // variable. Always create a new one on each request.\r\n  const supabase = createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return request.cookies.getAll();\r\n        },\r\n        setAll(cookiesToSet) {\r\n          cookiesToSet.forEach(({ name, value }) =>\r\n            request.cookies.set(name, value)\r\n          );\r\n          supabaseResponse = NextResponse.next({\r\n            request,\r\n          });\r\n          cookiesToSet.forEach(({ name, value, options }) =>\r\n            supabaseResponse.cookies.set(name, value, options)\r\n          );\r\n        },\r\n      },\r\n    }\r\n  );\r\n\r\n  // Do not run code between createServerClient and\r\n  // supabase.auth.getClaims(). A simple mistake could make it very hard to debug\r\n  // issues with users being randomly logged out.\r\n\r\n  // IMPORTANT: If you remove getClaims() and you use server-side rendering\r\n  // with the Supabase client, your users may be randomly logged out.\r\n\r\n  // Routes that don't require authentication\r\n  const PUBLIC_ROUTES = [\"/hero\", \"/about\", \"/login\", \"/auth/callback\", \"/404\"];\r\n  const isPublicRoute = PUBLIC_ROUTES.some((route) =>\r\n    request.nextUrl.pathname.startsWith(route)\r\n  );\r\n\r\n  // Skip auth check for public routes to prevent redirect loops\r\n  if (isPublicRoute) {\r\n    return supabaseResponse;\r\n  }\r\n\r\n  let user;\r\n  try {\r\n    const { data } = await supabase.auth.getClaims();\r\n    user = data?.claims;\r\n  } catch (error) {\r\n    //redirect login\r\n    const url = request.nextUrl.clone();\r\n    url.pathname = \"/login\";\r\n    return NextResponse.redirect(url);\r\n  }\r\n\r\n  if (!user) {\r\n    // no user, potentially respond by redirecting the user to the login page\r\n    const url = request.nextUrl.clone();\r\n    url.pathname = \"/login\";\r\n    return NextResponse.redirect(url);\r\n  }\r\n\r\n  // IMPORTANT: You *must* return the supabaseResponse object as it is. If you're\r\n  // creating a new response object with NextResponse.next() make sure to:\r\n  // 1. Pass the request in it, like so:\r\n  //    const myNewResponse = NextResponse.next({ request })\r\n  // 2. Copy over the cookies, like so:\r\n  //    myNewResponse.cookies.setAll(supabaseResponse.cookies.getAll())\r\n  // 3. Change the myNewResponse object to fit your needs, but avoid changing\r\n  //    the cookies!\r\n  // 4. Finally:\r\n  //    return myNewResponse\r\n  // If this is not done, you may be causing the browser and server to go out\r\n  // of sync and terminate the user's session prematurely!\r\n  supabaseResponse.headers.set(\"X-Content-Type-Options\", \"nosniff\");\r\n  supabaseResponse.headers.set(\"X-Frame-Options\", \"DENY\");\r\n  supabaseResponse.headers.set(\"X-XSS-Protection\", \"1; mode=block\");\r\n\r\n  return supabaseResponse;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\choco\\Downloads\\taskboard\\Taskboard\\utils\\supabase\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]